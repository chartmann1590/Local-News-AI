version: "3.8"
services:
  app:
    build: .
    container_name: news-ai-app
    ports:
      - "18080:8000"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Optional manual override. Leave unset to auto-detect location.
      - LOCATION_NAME=${LOCATION_NAME}
      - MIN_ARTICLES_PER_RUN=${MIN_ARTICLES_PER_RUN:-10}
      - TZ=${TZ:-America/New_York}
      - SCHEDULE_MORNING=${SCHEDULE_MORNING:-07:30}
      - SCHEDULE_NOON=${SCHEDULE_NOON:-12:00}
      - SCHEDULE_EVENING=${SCHEDULE_EVENING:-19:30}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:11434}
      - FEED_EXTRA_URLS=${FEED_EXTRA_URLS:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      - ./data:/data
    restart: unless-stopped

  tts:
    image: synesthesiam/opentts:latest
    container_name: news-ai-tts
    environment:
      # Limit to light, local voices; Piper is CPU-friendly
      - OPENTTS_ENGINES=piper
    volumes:
      - ./data/tts:/root/.local/share/opentts
    expose:
      - "5500"
    restart: unless-stopped

